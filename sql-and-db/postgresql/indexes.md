**[SQL, Базы данных](../../README.md#sql-and-db) ::** 
**[PostgreSQL](../../README.md#sql-and-db-postgresql) ::**
# Индексы

Вспомогательные структуры для повышения производительности поиска.

<!--
https://postgrespro.ru/docs/postgresql/17/indexes-types
https://habr.com/ru/companies/otus/articles/747882/
https://habr.com/ru/companies/postgrespro/articles/326096/
https://postgrespro.ru/docs/postgresql/17/indexes
https://tproger.ru/articles/indeksy-v-postgresql
https://habr.com/ru/companies/postgrespro/articles/326096/
https://habr.com/ru/companies/postgrespro/articles/326106/
https://habr.com/ru/companies/postgrespro/articles/328280/
https://habr.com/ru/companies/postgrespro/articles/330544/
https://habr.com/ru/companies/postgrespro/articles/333878/
https://habr.com/ru/companies/postgrespro/articles/337502/
https://habr.com/ru/companies/postgrespro/articles/340978/
https://habr.com/ru/companies/postgrespro/articles/343488/
https://habr.com/ru/companies/postgrespro/articles/346460/
https://habr.com/ru/companies/postgrespro/articles/349224/
https://habr.com/ru/articles/882106/
-->

[К оглавлению](../../README.md#sql-and-db-postgresql)

Данные в индексе хранятся в форме, позволяющей в процессе поиска не рассматривать области, которые не могут содержать искомые элементы. Не только сокращают время поиска в абсолютном выражении, но и уменьшают алгоритмическую сложность процесса поиска.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## B-дерево (B-tree, Balanced tree) <a name="b-tree"></a>
Описание структуры данных: [Сбалансированное дерево](../../data-structures/descriptions/trees.b.md)

- Хранит данные в отсортированном виде.
- Может работать в условиях на равенство и в проверках диапазонов с данными, которые можно отсортировать в некотором порядке.
- Может также применяться для получения данных, отсортированных по порядку (не всегда быстрее).

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с одним из следующих операторов `<   <=   =   >=   >`.
- При обработке конструкций `BETWEEN, IN`.
- В условиях `IS NULL, IS NOT NULL`.
- С операторами сравнения по шаблону `LIKE, ~`, если шаблон определяется константой и он привязан к началу строки (например, `col LIKE 'foo%'` или `col ~ '^foo'`, но не `col LIKE '%bar'`).
- Можно использовать для `ILIKE` и `~*`, если шаблон начинается не с алфавитных символов (символов, не подверженных преобразованию регистра).

[К оглавлению](../../README.md#sql-and-db-postgresql)

## Хеш (Hash) <a name="hash"></a>
Описание структуры данных: [Хэш-таблицы](../../data-structures/descriptions/hash-maps.md)

Хранит 32-битный хеш-код, полученный из значения индексированного столбца. При создании применяет хеш-функцию к каждому значению индексируемого столбца. Результат определяет, в какой бакет (bucket) попадёт запись. Подходит для столбцов с уникальными значениями или с минимальным количеством повторов.

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с оператором `=`.

**Подходит, если:**
- Данные размером от 100 тыс. до 50 млн. строк.
- Только операции =, без диапазонных запросов.
- Равномерное распределение значений (минимальные коллизии).
- Запросы выполняются очень часто (например, кэш-таблица).

**Не подходит, если:**
- Менее 100 тыс. записей → PostgreSQL и так быстро сканирует таблицу.
- Более 50 млн. записей → бакеты переполняются, индексация замедляется.
- Запросы с диапазонами (`<, >, BETWEEN`) → хеш-индекс не поддерживает.
- Много дубликатов → это приводит к переполнению страниц и снижению производительности.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## GiST (Generalized Search Tree, Обобщённое поисковое дерево) <a name="gist"></a>
Описание структуры данных:
- [Сбалансированное дерево](../../data-structures/descriptions/trees.b.md)
- [R-дерево](../../data-structures/descriptions/trees.r.md)

Представляет собой не просто разновидность индексов, а инфраструктуру, позволяющую реализовать много разных стратегий индексирования. На базе GiST могут быть реализованы B-деревья, R-деревья и многие другие схемы индексации.

- Поддерживает поиск ближайших соседей.
- Поддерживает различные определённые пользователем стратегии.

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с одним из следующих операторов `<<   &<   &>   >>   <<|   &<|   |&>   |>>   @>   <@   ~=   &&`.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## SP-GiST <a name="sp-gIst"></a>
Описание структуры данных: 
- [Несбалансированное дерево](../../data-structures/descriptions/trees.kd.md)
- [R-дерево](../../data-structures/descriptions/trees.r.md)

Представляет собой не просто разновидность индексов, а инфраструктуру, позволяющую реализовать много разных стратегий индексирования. Позволяет организовывать самые разные несбалансированные структуры данных, такие как деревья квадрантов, k-мерные и префиксные деревья.

- Поддерживает поиск ближайших соседей.
- Поддерживает различные определённые пользователем стратегии.

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с одним из следующих операторов `<<   >>   ~=   <@   <<|   |>>`.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## GIN <a name="gin"></a>

Представляет собой «инвертированный индекс», в котором могут содержаться значения с несколькими ключами, например массивы.

- Содержит отдельный элемент для значения каждого компонента.
- Эффективен в запросах, проверяющих присутствие определённых значений компонентов.
- Поддерживает различные определённые пользователем стратегии.

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с одним из следующих операторов `<@   @>   =   &&`.

**Полезны для организации**
- полнотекстового поиска;
- индексации массивов;
- индексации jsonb.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## BRIN (Block Range INdexes, Индексы зон блоков) <a name="brin"></a>

Хранит обобщённые сведения о значениях, находящихся в физически последовательно расположенных блоках таблицы. Наиболее эффективен для столбцов, значения в которых хорошо коррелируют с физическим порядком столбцов таблицы. Подходит для типов данных, имеющих линейный порядок сортировки, записям в индексе соответствуют минимальные и максимальные значения данных в столбце для каждой зоны блоков. 

Планировщик запросов может задействовать индекс, когда индексируемый столбец участвует:
- В сравнении с одним из следующих операторов `<   <=   =   >=   >`.


[К оглавлению](../../README.md#sql-and-db-postgresql)
