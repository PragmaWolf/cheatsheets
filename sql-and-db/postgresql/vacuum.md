**[SQL, Базы данных](../../README.md#sql-and-db) ::** 
**[PostgreSQL](../../README.md#sql-and-db-postgresql) ::**
# Освобождение пространства (VACUUM)

Проводит сборку мусора и, возможно, проанализирует базу данных.

```sql
VACUUM [ parameter, ...] [table_name [(column_name, ...)]];
```

[К оглавлению](../../README.md#sql-and-db-postgresql)

`VACUUM` - высвобождает пространство, занимаемое "мёртвыми" данными. При обычных операциях PostgreSQL данные, удалённые или устаревшие в результате обновления, физически не удаляются из таблицы; они сохраняются в ней. Пропускает страницы, учитывая [карту видимости](visibility-map.md) для таблиц.
- не требует исключительной блокировки;
- только высвобождает пространство и делает его доступным для повторного использования;
- необходимо выполнять VACUUM, особенно для часто изменяемых таблиц;
- нельзя выполнять внутри блока транзакции.
- для таблиц с индексами GIN, завершает все ожидающие операции добавления в индекс.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## Параметры (опционально)

**boolean** - Включает или отключает заданный параметр. Для включения параметра можно написать TRUE, ON или 1, а для отключения - FALSE, OFF или 0. Значение boolean можно опустить, в этом случае подразумевается TRUE.

`FULL [boolean]` - режим "полной" очистки. Следует использовать, только когда требуется высвободить значительный объём пространства, выделенного таблице.
- может освободить больше пространства;
- выполняется гораздо дольше;
- запрашивает исключительную блокировку таблицы;
- требует дополнительное место на диске;
- не рекомендуется для обычного применения;
- чаще всего сжимает таблицу более эффективно, чем обычный VACUUM.

`FREEZE [boolean]` - агрессивная "заморозка" данных. В режиме FULL это указание избыточно.

`VERBOSE [boolean]` - выводит подробный отчёт об очистке для каждой таблицы.

`ANALYZE [boolean]` - обновляет статистику, которую использует планировщик.

`DISABLE_PAGE_SKIPPING [boolean]` - отключает пропуск страниц. Предназначен для использования только когда целостность карты видимости вызывает подозрения. Отключает следующие условия пропуска:
- страницы, на которых, все кортежи заморожены, можно пропускать всегда;
- страницы, в которых все кортежи видны всем транзакциям, могут обрабатываться только при агрессивной очистке;
- страницы можно пропускать, чтобы не ждать, пока другие сеансы закончат их использовать.

`SKIP_LOCKED [boolean]` - не ждать освобождения никаких конфликтующих блокировок. Если отношение не удаётся заблокировать сразу, без ожидания, оно пропускается.
- может заблокироваться, открывая индексы отношения;
- может заблокироваться и при получении выборки строк из секций, потомков в иерархии наследования или некоторых видов сторонних таблиц;
- при наличии конфликтующей блокировки в секционированной таблице пропускает все её секции.

`INDEX_CLEANUP [boolean]` - должна попытаться удалить элементы индекса, указывающие на "мёртвые" данные.
- выполняется по умолчанию;
- можно отключить параметрами в конфиге БД;
- отключают когда нужно выполнить очистку как можно быстрее;
- не действует для таблиц, в которых нет индексов
- игнорируется в случае использования указания `FULL`.

`TRUNCATE [boolean]` - попытаться обрезать пустые страницы в конце таблицы.
- выполняется по умолчанию;
- можно отключить параметрами в конфиге БД;
- отключать, чтобы избежать блокировки ACCESS EXCLUSIVE для таблицы;
- игнорируется в случае использования указания FULL.

[К оглавлению](../../README.md#sql-and-db-postgresql)

## Таблица и столбцы (опционально)

**table_name** - Имя определённой таблицы или материализованного представления, подлежащего очистке. Если таблица является секционированной, очистке подвергаются все её конечные секции. Можно указать список через запятую.

**column_name** - Если указывается, также должно присутствовать указание ANALYZE. Имя столбца, подлежащего анализу. По умолчанию анализируются все столбцы. Можно указать список через запятую.

[К оглавлению](../../README.md#sql-and-db-postgresql)

> [!IMPORTANT]
> Если вы заметили ошибку, неточность, нехватку информации, пожалуйста, сообщите мне.
